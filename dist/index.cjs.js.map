{"version":3,"file":"index.cjs.js","sources":["../src/components/MapContext.js","../src/components/MapComponentsProvider.js","../src/components/SimpleDataContext.js","../src/components/SimpleDataProvider.js"],"sourcesContent":["import React from \"react\";\n\nconst MapContext = React.createContext({});\n\nexport const MapContextProvider = MapContext.Provider;\nexport default MapContext;\n","import React, { useState, useRef } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { MapContextProvider } from \"./MapContext\";\n\n/**\n * MapComponentsProvider must be imported and wrapped around component where at least one of its child nodes requires access to a MapLibre-gl or openlayers instance that is registered in this mapContext.\nMapComponentsProvider must be used one level higher than the first use of MapContext.\n *\n * MapComponentsProvider requires at least one use of the MapLibreMap component somewhere down the component tree that will create the MapLibre-gl object and set the reference at MapContext.map. For MapLibre maps it is a good idea to provide a mapId attribute to the MapLibreMap Component even if you are only using a single map instance at start. It will make a later transition to using multiple instances within the same project much easier.\n */\n\nconst MapComponentsProvider = ({ children }) => {\n  const [map, setMap] = useState(undefined);\n  const [mapIds, setMapIds] = useState([]);\n  let mapIds_raw = useRef([]);\n  let maps = useRef({});\n\n  const [mapStates, setMapStates] = useState({});\n  let mapStatesRef = useRef({});\n\n  const removeMap = (mapId) => {\n      if(mapId){\n        if(typeof maps.current[mapId] !== 'undefined'){\n          delete maps.current[mapId];\n        }\n        let mapIdIndex = mapIds_raw.current.indexOf(mapId);\n        if (mapIdIndex > -1) {\n          mapIds_raw.current.splice(mapIdIndex, 1);\n        }\n        setMapIds([...mapIds_raw.current]);\n\n        if(mapIds.length === 1 && map){\n          setMap(undefined);\n        }\n      }else{\n        setMap(undefined);\n        removeMap('anonymous_map');\n      }\n    }\n\n  const setMapHandler = (mapInstance, mapState) => {\n        setMap(mapInstance);\n\n        if(mapIds.length === 0){\n          let mapId = 'anonymous_map';\n          setMapIds([...mapIds, mapId]);\n          maps.current[mapId] = mapInstance;\n          mapStatesRef.current[mapId] = mapState;\n          setMapStates({...mapStatesRef.current});\n        }\n    };\n\n  const value = {\n    map: map,\n    setMap: setMapHandler,\n    maps: maps.current,\n    mapIds: mapIds,\n    registerMap: (mapId, mapInstance, mapState) => {\n      if(mapId && mapInstance){\n          maps.current[mapId] = mapInstance;\n          mapIds_raw.current.push(mapId);\n          setMapIds([...mapIds_raw.current]);\n\n          mapStatesRef.current[mapId] = mapState;\n\n          if(!map){\n            setMap(mapInstance);\n            mapStatesRef.current['anonymous_map'] = mapState;\n          }\n          setMapStates({...mapStatesRef.current});\n      }\n    },\n    removeMap,\n    mapExists: (mapId) => {\n      if (mapId && Object.keys(maps.current).indexOf(mapId) === -1) {\n        return false;\n      } else if (!mapId && !map) {\n        return false;\n      }\n      return true;\n    },\n    getMap: (mapId) => {\n      if (mapId && mapIds.indexOf(mapId) !== -1) {\n        return maps.current[mapId];\n      } else if (!mapId && map) {\n        return map;\n      }\n\n      return null;\n    },\n  };\n\n  return <MapContextProvider value={value}>{children}</MapContextProvider>;\n};\n\nMapComponentsProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default MapComponentsProvider;\n","import React from \"react\";\n\nconst SimpleDataContext = React.createContext({});\n\nexport const SimpleDataContextProvider = SimpleDataContext.Provider;\nexport default SimpleDataContext;\n","import React, { useEffect, useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { SimpleDataContextProvider } from \"./SimpleDataContext\";\nimport * as d3 from \"d3\";\n\nconst SimpleDataProvider = (props) => {\n  const [data, setData] = useState(null);\n  useEffect(() => {\n    if (!props.url) return;\n\n    let data_promise = null;\n    if (props.format === \"json\") {\n      data_promise = d3.json(props.url);\n    } else if (props.format === \"csv\") {\n      data_promise = d3.csv(props.url);\n    } else if (props.format === \"xml\") {\n      data_promise = d3.xml(props.url);\n    }\n\n    if (data_promise) {\n      data_promise.then((received_data) => {\n        if (props.format === \"xml\") {\n          if (props.nodeType) {\n            let dataTmp = [];\n            received_data.querySelectorAll(props.nodeType).forEach((el) => {\n\n              dataTmp.push(props.formatData(el));\n            });\n            setData(dataTmp);\n          }\n        } else {\n          if (props.data_property) {\n            received_data = received_data[props.data_property];\n          }\n          if (typeof props.formatData === \"function\") {\n            setData(received_data.map(props.formatData));\n          } else {\n            setData(received_data);\n          }\n        }\n        if (typeof props.onData === \"function\") {\n          props.onData();\n        }\n      });\n    }\n  }, [props.url, props]);\n\n  const value = {\n    data: data,\n    setData: setData,\n  };\n\n  return (\n    <SimpleDataContextProvider value={value}>\n      {props.children}\n    </SimpleDataContextProvider>\n  );\n};\n\nSimpleDataProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default SimpleDataProvider;\n"],"names":["MapContext","React","createContext","MapContextProvider","Provider","MapComponentsProvider","children","useState","undefined","map","setMap","mapIds","setMapIds","mapIds_raw","useRef","maps","setMapStates","mapStatesRef","removeMap","mapId","current","mapIdIndex","indexOf","splice","length","setMapHandler","mapInstance","mapState","value","registerMap","push","mapExists","Object","keys","getMap","propTypes","PropTypes","node","isRequired","SimpleDataContext","SimpleDataContextProvider","SimpleDataProvider","props","data","setData","useEffect","url","data_promise","format","d3","json","csv","xml","then","received_data","nodeType","dataTmp","querySelectorAll","forEach","el","formatData","data_property","onData"],"mappings":"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"}