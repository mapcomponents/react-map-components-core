{"version":3,"file":"index.cjs.js","sources":["../src/components/MapContext.js","../src/components/MapComponentsProvider.js","../src/components/SimpleDataContext.js","../src/components/SimpleDataProvider.js"],"sourcesContent":["import React from \"react\";\n\nconst MapContext = React.createContext({});\n\nexport const MapContextProvider = MapContext.Provider;\nexport default MapContext;\n","import React, { useState, useRef } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { MapContextProvider } from \"./MapContext\";\n\n/**\n * MapComponentsProvider must be imported and wrapped around component where at least one of its child nodes requires access to a MapLibre-gl or openlayers instance that is registered in this mapContext.\nMapComponentsProvider must be used one level higher than the first use of MapContext.\n *\n * MapComponentsProvider requires at least one use of the MapLibreMap component somewhere down the component tree that will create the MapLibre-gl object and set the reference at MapContext.map. For MapLibre maps it is a good idea to provide a mapId attribute to the MapLibreMap Component even if you are only using a single map instance at start. It will make a later transition to using multiple instances within the same project much easier.\n */\n\nconst MapComponentsProvider = ({ children }) => {\n  const [map, setMap] = useState(undefined);\n  const [mapIds, setMapIds] = useState([]);\n  let mapIds_raw = useRef([]);\n  let maps = useRef({});\n\n  const value = {\n    map: map,\n    setMap: (mapInstance) => {\n        setMap(mapInstance);\n\n        if(mapIds.length === 0){\n          let mapId = Math.round(Math.random()*100000000);\n          setMapIds([...mapIds, mapId]);\n          maps.current[mapId] = mapInstance;\n        }\n    },\n    maps: maps.current,\n    mapIds: mapIds,\n    registerMap: (mapId, mapInstance) => {\n      if(mapId && mapInstance){\n          maps.current[mapId] = mapInstance;\n          mapIds_raw.current.push(mapId);\n          setMapIds([...mapIds_raw.current]);\n\n          if(!map){\n            setMap(mapInstance);\n          }\n      }\n    },\n    removeMap: (mapId) => {\n      if(mapId){\n        if(typeof maps.current[mapId] !== 'undefined'){\n          maps.current[mapId] = null;\n        }\n        let mapIdIndex = mapIds_raw.current.indexOf(mapId);\n        if (mapIdIndex > -1) {\n          mapIds_raw.current.splice(mapIdIndex, 1);\n        }\n        setMapIds([...mapIds_raw.current]);\n\n        if(mapIds.length === 1 && map){\n          setMap(undefined);\n        }\n      }else{\n        setMap(undefined);\n        mapIds_raw.current = [];\n        setMapIds([]);\n        maps.current = {};\n      }\n    },\n    mapExists: (mapId) => {\n      if (mapId && mapIds.indexOf(mapId) === -1) {\n        return false;\n      } else if (!mapId && !map) {\n        return false;\n      }\n      return true;\n    },\n    getMap: (mapId) => {\n      if (mapId && mapIds.indexOf(mapId) !== -1) {\n        return maps.current[mapId];\n      } else if (!mapId && map) {\n        return map;\n      }\n\n      return null;\n    },\n  };\n\n  return <MapContextProvider value={value}>{children}</MapContextProvider>;\n};\n\nMapComponentsProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default MapComponentsProvider;\n","import React from \"react\";\n\nconst SimpleDataContext = React.createContext({});\n\nexport const SimpleDataContextProvider = SimpleDataContext.Provider;\nexport default SimpleDataContext;\n","import React, { useEffect, useState } from \"react\";\nimport PropTypes from \"prop-types\";\nimport { SimpleDataContextProvider } from \"./SimpleDataContext\";\nimport * as d3 from \"d3\";\n\nconst SimpleDataProvider = (props) => {\n  const [data, setData] = useState(null);\n  useEffect(() => {\n    if (!props.url) return;\n\n    let data_promise = null;\n    if (props.format === \"json\") {\n      data_promise = d3.json(props.url);\n    } else if (props.format === \"csv\") {\n      data_promise = d3.csv(props.url);\n    } else if (props.format === \"xml\") {\n      data_promise = d3.xml(props.url);\n    }\n\n    if (data_promise) {\n      data_promise.then((received_data) => {\n        if (props.format === \"xml\") {\n          if (props.nodeType) {\n            let dataTmp = [];\n            received_data.querySelectorAll(props.nodeType).forEach((el) => {\n\n              dataTmp.push(props.formatData(el));\n            });\n            setData(dataTmp);\n          }\n        } else {\n          if (props.data_property) {\n            received_data = received_data[props.data_property];\n          }\n          if (typeof props.formatData === \"function\") {\n            setData(received_data.map(props.formatData));\n          } else {\n            setData(received_data);\n          }\n        }\n        if (typeof props.onData === \"function\") {\n          props.onData();\n        }\n      });\n    }\n  }, [props.url, props]);\n\n  const value = {\n    data: data,\n    setData: setData,\n  };\n\n  return (\n    <SimpleDataContextProvider value={value}>\n      {props.children}\n    </SimpleDataContextProvider>\n  );\n};\n\nSimpleDataProvider.propTypes = {\n  children: PropTypes.node.isRequired,\n};\n\nexport default SimpleDataProvider;\n"],"names":["MapContext","React","createContext","MapContextProvider","Provider","MapComponentsProvider","children","useState","undefined","map","setMap","mapIds","setMapIds","mapIds_raw","useRef","maps","value","mapInstance","length","mapId","Math","round","random","current","registerMap","push","removeMap","mapIdIndex","indexOf","splice","mapExists","getMap","propTypes","PropTypes","node","isRequired","SimpleDataContext","SimpleDataContextProvider","SimpleDataProvider","props","data","setData","useEffect","url","data_promise","format","d3","json","csv","xml","then","received_data","nodeType","dataTmp","querySelectorAll","forEach","el","formatData","data_property","onData"],"mappings":"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"}